module(..., package.seeall);

--[[
% Rows of the above matrices indicate the following variables
ind_LHipYawPitch=1;
ind_LHipRoll=2;
ind_LHipPitch=3;
ind_LKneePitch=4;
ind_LAnklePitch=5;
ind_LAnkleRoll=6;
ind_RHipYawPitch=7;
ind_RHipRoll=8;
ind_RHipPitch=9;
ind_RKneePitch=10;
ind_RAnklePitch=11;
ind_RAnkleRoll=12;
-]]

-- Bezier coefficients when leg is in stance
-- Webots coefficients
--[[
alpha_L = { 
{  0.0116, -0.0434, -0.0938, -0.0815, -0.0716, -0.0137},
{  0.0347, -0.1572, -0.1608, -0.1141, -0.1822, -0.0426},
{ -0.8720, -0.9939, -0.7674, -0.8201, -0.8512, -0.7867},
{  0.3166,  0.7123,  0.4419,  0.5367,  0.7343,  0.7908},
{  0.2060, -0.0657, -0.0368, -0.0744, -0.2365, -0.3534},
{ -0.0339,  0.1279,  0.2717,  0.2313,  0.2101,  0.0398},
{  0.0064, -0.0287, -0.1031, -0.1698, -0.0340, -0.0209},
{  0.0175, -0.0830, -0.2796, -0.4446, -0.1010, -0.0569},
{ -0.8218, -0.5803,  0.1116, -3.9721,  0.5099, -0.9724},
{  0.8857,  0.3302,  0.6159,  4.7666, -2.2055,  0.4532},
{ -0.4188, -0.0324, -1.2454, -1.3482,  1.3277,  0.1769},
{ -0.0194,  0.0872,  0.2985,  0.4749,  0.1067,  0.0601}
} ;

alpha_R = { 
{ -0.0065,  0.0286,  0.1031,  0.1698,  0.0339,  0.0208},
{ -0.0179,  0.0811,  0.2820,  0.4426,  0.1022,  0.0564},
{ -0.8232, -0.5830,  0.1051, -3.9613,  0.5055, -0.9778},{  0.8827,  0.3300,  0.6010,  4.7720, -2.1928,  0.4708},{ -0.4143, -0.0315, -1.2179, -1.3593,  1.3204,  0.1645},{  0.0197, -0.0870, -0.2984, -0.4750, -0.1066, -0.0598},{ -0.0117,  0.0433,  0.0939,  0.0815,  0.0716,  0.0136},{ -0.0351,  0.1569,  0.1614,  0.1133,  0.1829,  0.0419},{ -0.8693, -0.9940, -0.7641, -0.8232, -0.8502, -0.7891},{  0.3166,  0.7167,  0.4397,  0.5375,  0.7328,  0.7904},{  0.2031, -0.0694, -0.0357, -0.0750, -0.2347, -0.3507},{  0.0342, -0.1277, -0.2719, -0.2313, -0.2101, -0.0395}
};
--]]

-- Alpha from slower walk parameters, longer stride length
--[[
-- Slow walk
walk.tZmp = 0.165;
walk.tStep = 0.5;
walk.phSingle={0.1,0.9};
walk.supportY = 0.010;
walk.supportX = -0.005;
walk.stepHeight = 0.06;
walk.qLArm=math.pi/180*vector.new({90,0,-80});
walk.qRArm=math.pi/180*vector.new({90,0,-80});
--]]
--[[
alpha_L={
{0,0,0,0,0,0,0},
{  0.0011, -0.1707,  0.2745, -0.6262, 0.2900, -0.1883, -0.0142},
{ -0.4935, -0.4341, -0.3611, -0.3445, -0.3146, -0.3083, -0.2258},
{  0.9551,  0.9326,  0.9528,  0.7516, 0.9057,  0.8637,  0.8682},
{ -0.4484, -0.5144, -0.4791, -0.5552, -0.5161, -0.6099, -0.6330},
{  0.0484,  0.2014,  0.0991,  0.2846, 0.1279,  0.1652,  0.0086},
{0,0,0,0,0,0,0},
{  0.0099, -0.1207, -0.0285, -0.6439,  0.0630, -0.1570,  0.0154},
{ -0.2388,  0.0248, -0.6065, -1.4204, -0.9390, -0.3669, -0.5239},
{  0.8967,  0.3473,  2.1253,  3.1100,  1.2767,  0.6664,  0.9784},
{ -0.6579, -0.3721, -1.5188, -1.6895, -0.3377, -0.2995, -0.4545},
{ -0.0099,  0.1207,  0.0285,  0.6439, -0.0630,  0.1570, -0.0154}
}

alpha_R={
{0,0,0,0,0,0,0},
{ -0.0087,  0.1209,  0.0298,  0.6411,-0.0604,  0.1569, -0.0136},
{ -0.2440,  0.0160, -0.6420, -1.3806, -0.9502, -0.3561, -0.5193},
{  0.8991,  0.3576,  2.1616,  3.0429, 1.3304,  0.6534,  0.9772},
{ -0.6550, -0.3736, -1.5196, -1.6623, -0.3802, -0.2973, -0.4579},
{  0.0087, -0.1209, -0.0298, -0.6411, 0.0604, -0.1569,  0.0136},
{0,0,0,0,0,0,0},
{  0.0105,  0.1318, -0.2179,  0.5597, -0.2343,  0.1679,  0.0205},
{ -0.4882, -0.4309,-0.3605, -0.3446, -0.3155, -0.3110, -0.2325},
{  0.9558,  0.9146,  0.9660,  0.7865,  0.8443,  0.9058,  0.8742},
{ -0.4539, -0.5203, -0.4766, -0.5464, -0.5312, -0.5967, -0.6278},
{ -0.0263, -0.2847,  0.0208, -0.4238, -0.0137, -0.2032, -0.0010} 
}
--]]

--[[
-- Stable tall walk (imu readings are legit, but the curve fitting doesn't look too great...)
walk.tZmp = 0.165;
walk.tStep = 0.35;
walk.phSingle={0.1,0.9};
walk.supportY = 0.010;
walk.supportX = -0.010;
walk.qLArm=math.pi/180*vector.new({90,0,-80});
walk.qRArm=math.pi/180*vector.new({90,0,-80});
walk.bodyHeight = 0.31;
walk.bodyTilt = 0*math.pi/180;
walk.stepHeight = 0.03;
--]]

alpha_L = {{0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, },
{0.016076, -0.170731, 0.398037, -0.607635, 0.673643, -0.761480, 0.521686, -0.192989, },
{-0.280335, -0.252966, -0.212310, -0.179353, -0.154552, -0.125957, -0.112486, -0.083128, },
{0.474582, 0.645408, 0.213573, 0.753544, 0.667544, -0.446550, 1.049988, 0.235997, },
{-0.193683, -0.190045, -0.307234, -0.172797, -0.202717, -0.498313, -0.145338, -0.381892, },
{0.062982, 0.120246, -0.042611, 0.303712, 0.162894, -0.046333, 0.243361, 0.065053, },
{0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, },
{0.008704, -0.037357, -0.076296, -0.075286, -0.186388, -0.052872, -0.085043, -0.036171, },
{-0.037504, 0.138790, 0.104553, -1.616615, 0.732982, -2.064151, 0.234987, -0.402369, },
{0.385747, 0.115961, 0.197284, 3.601109, -1.405028, 3.900741, -0.701451, 0.623936, },
{-0.348243, -0.254750, -0.301838, -1.984492, 0.672043, -1.836588, 0.466463, -0.221566, },
{-0.008704, 0.037357, 0.076296, 0.075286, 0.186388, 0.052872, 0.085043, 0.036171, },
};

alpha_R = {{0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, },
{-0.008451, 0.037393, 0.076453, 0.075200, 0.186193, 0.053162, 0.084897, 0.036474, },
{-0.045807, 0.120079, 0.097948, -1.612394, 0.717925, -2.038517, 0.232344, -0.390343, },
{0.393597, 0.141138, 0.196048, 3.584950, -1.374490, 3.868130, -0.681011, 0.614314, },
{-0.347790, -0.261217, -0.293995, -1.972561, 0.656573, -1.829620, 0.448671, -0.223971, },
{0.008451, -0.037393, -0.076453, -0.075200, -0.186193, -0.053162, -0.084897, -0.036474, },
{0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, },
{-0.006402, 0.203143, -0.469948, 0.649469, -0.627202, 0.647365, -0.405941, 0.146555, },
{-0.276982, -0.250244, -0.210508, -0.178793, -0.154353, -0.127747, -0.114479, -0.087298, },
{0.487225, 0.666977, -0.102330, 1.264476, 0.189423, -0.226074, 0.933185, 0.276047, },
{-0.196651, -0.187987, -0.388153, -0.045899, -0.322374, -0.442580, -0.173066, -0.369486, },
{-0.041102, -0.047773, -0.109537, -0.239186, -0.013583, -0.250614, 0.038720, -0.174486, },
};

theta_min_L = alpha_L[5][1];
theta_max_L = alpha_L[5][ #(alpha_L[5]) ];
theta_min_R = alpha_R[11][1];
theta_max_R = alpha_R[11][ #(alpha_R[11]) ];

--[[
theta_min_L = -0.4484
theta_max_L = -0.6330
theta_min_R = -0.4539
theta_max_R = -0.6278
--]]

-- Arm position
qLArm=math.pi/180*vector.new({90,10,-90});
qRArm=math.pi/180*vector.new({90,-10,-90});
hardnessArm = 0.3;
hardnessLeg = 1*vector.new({1,1,1,1,1,1});

